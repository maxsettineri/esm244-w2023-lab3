---
title: "Lab 3 - binomial logistic regression"
author: "Max Settineri"
date: "2023-01-26"
output: html_document
---

```{r setup, include = TRUE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(GGally)
library(jtools)
library(AICcmodavg)
```

## pseudocode

* Examine our data (plots, tables, summary stats)
* Identify a question
* Wrangle data
* Identify candidate models
* Select among candidate models usin AIC/BIC
* Select among candidate models using kfold cross validation
* Select among candidate models using area under receiver operating characteristic curve

```{r}
# exploratory plots
GGally::ggpairs(penguins %>% select(species, bill_length_mm:sex),
                aes(color = species))
```

```{r}
class(penguins$species) # checking class
levels(penguins$species) # checkinbg levels of factor

adelle_chinstrap <- penguins %>% 
  filter(species %in% c('Adelie', 'Chinstrap')) %>% 
  mutate(species = fct_drop(species)) %>% # dropping levels that no longer exist in species column
  select(-year) %>% # dropping year
  drop_na()
```

## Looking at trends accross variables

```{r}
ggplot(data = adelle_chinstrap, aes(x = body_mass_g, y = flipper_length_mm)) +
  geom_point(aes(color = sex, shape = island)) +
  facet_wrap(~species)

ggplot(data = adelle_chinstrap, aes(x = body_mass_g, y = bill_length_mm)) +
  geom_point(aes(color = sex, shape = island)) +
  facet_wrap(~species)
```

## Binary logistic regression

```{r}
f1 <- species ~ body_mass_g + flipper_length_mm + sex

ad_chin_blr1 <- glm(formula = f1, data = adelle_chinstrap, family = 'binomial')

ad_chin_blr1
summary(ad_chin_blr1)

blr1_tidy <- tidy(ad_chin_blr1) # makes nice table
```

```{r}
ggplot(data = adelle_chinstrap, aes(x = species, y = flipper_length_mm)) +
  geom_jitter(aes(color = sex))
```

```{r}
blr1_fitted <- ad_chin_blr1 %>% 
  broom::augment(type.predict = 'response')

ggplot(data = blr1_fitted, aes(x = flipper_length_mm, y = .fitted)) +
  geom_point(aes(color = sex, shape = species)) +
  geom_smooth(aes(color = sex, se = FALSE)) +
  labs(x = 'Flipper length (mm)',
   	   y = "Probability of outcome Chinstrap")
```

## Predictions for new values with predict()

```{r}
ex1 <- predict(ad_chin_blr1,
               data.frame(sex = 'female',
                          body_mass_g = 3410,
                          flipper_length_mm = 192),
               type = 'response')

new_df <- data.frame(
  sex = c('male', 'female', 'female'),
  body_mass_g = c(3298, 4100, 3600),
  flipper_length_mm = c(212, 175, 180)
)

ex2 <- predict(ad_chin_blr1, new_df, type = 'response')
ex2
```

## Create a new binary logistic model

```{r}
f2 <- species ~ bill_length_mm + body_mass_g

ad_chin_blr2 <- glm(formula = f2, data = adelle_chinstrap, family = 'binomial')

ad_chin_blr2
summary(ad_chin_blr2)
blr2_tidy <- tidy(ad_chin_blr2)
```

```{r}
ggplot(adelle_chinstrap, aes(x = bill_length_mm, y = body_mass_g)) +
  geom_point(aes(color = species))
```

